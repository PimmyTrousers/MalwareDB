# import db_handler
from imports.pretty import *
import sys
import re

class Terminal_Controller:
    def __init__(self):

        self.modules = None
        self.currentmodule = None
        # self.db = db_handler.DBHandler()

        self.commands = [('help', 'Displays this help menu'),
                         ('use', 'selects a malware sample'),
                         ('info', 'displays information about a malware sample'),
                         ('download', 'downloads the selected malware sample'),
                         ('exit', 'leaves the malwareDB'),
                         ('search', 'allows the user to search for a sample')]

        self.bare_commands = {('help'),
                              ('use'),
                              ('info'),
                              ('download'),
                              ('exit'),
                              ('search')}


        self.searchmeth = [("arch", "which architecture etc; x86, x64, arm7 so on..."),
                           ("plat",
                            "platform: win32, win64, mac, android so on..."),
                           ("lang", "c, cpp, vbs, bin so on..."),
                           ("vip", "1 or 0"),
                           ("classification", "which malware classification is it...")]

        self.modules = self.GetPayloads()

    def MainMenu(self):
        # This will give you the nice prompt you like so much
        while (True):  # Dont hate, affiliate
            try:
                if self.currentmodule is not None:
                    # just_print = self.db.query("SELECT NAME FROM Malwares WHERE ID=?", self.currentmodule)[0][0]
                    cmd = input(bold(green('mdb ')) + bold(blue(just_print)) + green('$> ')).strip()
                else:
                    cmd = input(bold(green('mdb ')) + green('$> ')).strip()
            except KeyboardInterrupt:
                print(bold(blue("\n\n[*]")) + " Good bye from Pim's" + bold(red(" malwareDB")) + "!")
                exit()

            self.actOnCommand(cmd)

    def GetPayloads(self):
        return None # self.db.get_full_details()

    def actOnCommand(self, cmd):
        try:
            while cmd == "":
                return

            if cmd == "help":
                for cmds in self.commands:
                    print("{}\t{}".format(cmds[0], cmds[1]))
                return

            if re.match("^use", cmd):

                return

            if cmd == "info":

                return

            if cmd == "download":

                return

            if cmd == "exit":
                print(bold(blue("\n\n[*]")) + " Good bye from Pim's" + bold(red(" malwareDB")) + "!")
                sys.exit()
                return

            if cmd == "search":

                return

            else:
                print(red("[!] unknown command: {}".format(cmd)))

                return


        except KeyboardInterrupt:
            print("\n\nI'll just go now...")
        sys.exit()


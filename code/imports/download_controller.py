import paramiko
from imports.pretty import *

config = {}
exec(compile(open("imports/keys.py", "rb").read(), "imports/keys.py", 'exec'), config)


class Download_Controller:
    def __init__(self):
        self.client = paramiko.SSHClient()
        self.client.set_missing_host_key_policy(paramiko.AutoAddPolicy())

    def download_file(self, location):
        base = "/root/malware"
        try:
            self.client.connect(config['host'], username=config['user'], password=config['ssh_pass'])
        except paramiko.SSHException:
            print(red("[!] could not connect to remote host"))
        sftp = self.client.open_sftp()
        sftp.chdir(base)
        sftp.get(location, location)
        self.client.close()

    def upload_file(self, location):
        result = False
        base = "/root/malware/"
        try:
            self.client.connect(config['host'], username=config['user'], password=config['ssh_pass'])
        except paramiko.SSHException:
            print(red("[!] could not connect to remote host"))
        sftp = self.client.open_sftp()
        sftp.chdir(base)
        try:
            sftp.put(location, base + location)
            print("file {} was found!".format(location))
            result = True
        except:
            print(red("[!] file not in local directory"))
        self.client.close()
        return result

    def delete_remote_file(self, location):
        result = False
        base = "/root/malware/"
        try:
            self.client.connect(config['host'], username=config['user'], password=config['ssh_pass'])
        except paramiko.SSHException:
            print(red("[!] could not connect to remote host"))
        sftp = self.client.open_sftp()
        sftp.chdir(base)
        try:
            sftp.remove(base + location)
            print("Successfully removed {}".format(location))
            result = True
        except:
            print(red("[!] Couldn't remove {}".format(location)))
        self.client.close()
        return result
